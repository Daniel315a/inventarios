<div #divForm class="form-filtros">

    <form 
        #frmCotizacion 
        autocomplete="off" 
        (keydown.enter)="$event.preventDefault()">

        <!-- Fecha -->

        <div class="field is-horizontal">
            <div class="field-label is-normal">
                <label class="level-left">{{labels.fecha}}</label>
            </div>
            <div class="field-body">
                
                <div class="control">

                    <input 
                        class="input is-small"
                        type="date"
                        name="fecha"
                        [(ngModel)]="cotizacion.fecha">

                </div>

            </div>
        </div>

        <!-- FIN: Fecha -->

        <!-- Cliente -->

        <app-txt-persona
            #txtCliente
            [labelPersona]="labels.cliente"
            [tipoPersona]="tipoPersonaCliente"
            (personaSeleccionada)="clienteSeleccionado($event)">
        </app-txt-persona>

        <!-- FIN: Cliente -->

        <!-- Notas -->

        <div class="field is-horizontal">
            <div class="field-label is-normal">
                <label class="level-left">{{labels.notas}}</label>
            </div>
            <div class="field-body">

            <textarea 
                class="textarea is-small is-uppercase"
                rows="2"
                name="notas"
                [(ngModel)]="cotizacion.notas">
            </textarea>

            </div>
        </div>

        <!-- FIN: Notas -->

        <!-- Detalles -->

        <div class="box">
                
            <div class="field is-grouped">
                
                <!-- Cantidad -->

                <div
                    class="control txt-pequenno"
                    [attr.data-tooltip]="detalleActual.cantidad == null ? null : labels.cantidad">
                    <input 
                        class="input is-small"
                        type="number"
                        placeholder="{{labels.cantidad}}"
                        name="cantidad"
                        [(ngModel)]="detalleActual.cantidad">
                </div>
                
                <!-- FIN: Cantidad -->

                <!-- Producto -->

                <div class="control">
                    <app-select-productos #selectProducto
                        (productoSeleccionado)="productoSeleccionado($event)">
                    </app-select-productos>
                </div>

                <!-- FIN: Producto -->

                <!-- Descripcion -->

                <div
                    class="control is-expanded"
                    [attr.data-tooltip]="detalleActual.descripcion == null || detalleActual.descripcion.length == 0 ? null : labels.descripcion">
                    <input 
                        class="input is-small is-uppercase"
                        type="text"
                        placeholder="{{labels.descripcion}}"
                        name="descripcion"
                        [(ngModel)]="detalleActual.descripcion">
                </div>

                <!-- FIN: Descripcion -->

                <!-- Porcentaje de IVA -->

                <div
                    class="control txt-valor"
                    [attr.data-tooltip]="detalleActual.porcentajeIva == null ? null : labels.iva">
                    <input 
                        class="input is-small"
                        type="number"
                        placeholder="{{labels.iva}}"
                        name="iva"
                        [(ngModel)]="detalleActual.porcentajeIva">
                </div>

                <!-- Porcentaje de IVA -->

                <!-- Precio -->

                <div
                    class="control txt-valor"
                    [attr.data-tooltip]="detalleActual.precioUnitario == null ? null : labels.precioUnitario">
                    <input 
                        class="input is-small"
                        type="number"
                        placeholder="{{labels.precioUnitario}}"
                        name="precioUnitario"
                        [(ngModel)]="detalleActual.precioUnitario">
                </div>

                <!-- Precio -->

                <!-- Botón de agregar detalle -->

                <div class="control">
                    <button 
                        class="button is-small is-primary"
                        (click)="agregarDetalle()"
                        (keydown.enter)="agregarDetalle()">
                        <span class="icon is-small">
                            <i class="fas fa-plus"></i>
                        </span>
                    </button>
                </div>

                <!-- FIN: Botón de agregar detalle -->

            </div>

        </div>

        <!-- FIN: Detalles -->

    </form>

</div>

<div #divTablaDetalles class="div-tabla is-size-7" [style.height.px]="altoTablaDetalles">

    <table class="table is-fullwidth is-bordered">

        <thead>
            <tr>
                <th width="10%">{{columnas.cantidad}}</th>
                <th>{{columnas.descripcion}}</th>
                <th width="15%">{{columnas.precioUnitario}}</th>
                <th width="12%">{{columnas.iva}}</th>
                <th width="12%">{{columnas.precioTotal}}</th>
            </tr>
        </thead>

        <tbody>

            <tr *ngFor="let detalle of cotizacion.detalles; let i = index" (click)="llenarDetalle(detalle, i)">
                <td>{{detalle.cantidad}}</td>
                <td>{{detalle.descripcion}}</td>
                <td>{{detalle.precioUnitario}}</td>
                <td>{{detalle.valorIva}}</td>
                <td>{{detalle.precioTotal}}</td>
            </tr>

        </tbody>

    </table>

</div>

<br>

<!-- Totales -->

<div class="field is-grouped is-grouped-right">

    <div class="control">

        <div class="field is-horizontal">
            <div class="field-label is-normal">
                <label class="level-left">{{labels.totalIva}}</label>
            </div>
            <div class="field-body">

                <input 
                    class="input is-small"
                    type="text"
                    name="totalIva"
                    [(ngModel)]="cotizacion.totalIva"
                    disabled>

            </div>
        </div>


        <div class="field is-horizontal">
            <div class="field-label is-normal">
                <label class="level-left">{{labels.precioTotal}}</label>
            </div>
            <div class="field-body">

                <input 
                    class="input is-small"
                    type="text"
                    name="precioTotal"
                    [(ngModel)]="cotizacion.precioTotal"
                    disabled>

            </div>
        </div>

    </div>

</div>

<!-- FIN: Totales -->

<!-- Botones -->

<div class="field is-grouped is-grouped-right">
    
    <div class="control">
        <button
            class="button is-small is-primary"
            (click)="guardar()">
            {{botones.guardar}}
        </button>
    </div>

    <div class="control">
        <button class="button is-small is-danger">
            {{botones.eliminar}}
        </button>
    </div>

    <div class="control">
        <button class="button is-small has-text-primary">
            <span class="icon is-small">
                <i class="fas fa-eraser"></i>
            </span>
        </button>
    </div>

</div>

<!-- FIN: Botones -->