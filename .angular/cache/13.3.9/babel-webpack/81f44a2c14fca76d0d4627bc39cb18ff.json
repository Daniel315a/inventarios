{"ast":null,"code":"import { Cotizacion } from 'src/app/models/cotizacion';\nimport { DetalleCotizacion } from 'src/app/models/detalle-cotizacion';\nimport { Utilidades } from 'src/app/models/utilidades';\nimport { CotizacionService } from 'src/app/services/cotizacion.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/services/cotizacion.service\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"../txt-persona/txt-persona.component\";\nimport * as i5 from \"../select-productos/select-productos.component\";\nimport * as i6 from \"@angular/common\";\nconst _c0 = [\"divForm\"];\nconst _c1 = [\"frmCotizacion\"];\nconst _c2 = [\"selectProducto\"];\n\nfunction CotizacionComponent_tr_53_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\", 40);\n    i0.ɵɵlistener(\"click\", function CotizacionComponent_tr_53_Template_tr_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const detalle_r6 = restoredCtx.$implicit;\n      const i_r7 = restoredCtx.index;\n      const ctx_r8 = i0.ɵɵnextContext();\n      return ctx_r8.llenarDetalle(detalle_r6, i_r7);\n    });\n    i0.ɵɵelementStart(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const detalle_r6 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(detalle_r6.cantidad);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(detalle_r6.descripcion);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(detalle_r6.precioUnitario);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(detalle_r6.valorIva);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(detalle_r6.precioTotal);\n  }\n}\n\nexport let CotizacionComponent = /*#__PURE__*/(() => {\n  class CotizacionComponent {\n    constructor(route, _cotizacionService) {\n      this.route = route;\n      this._cotizacionService = _cotizacionService;\n      this.cotizacion = new Cotizacion();\n      this.detalleActual = new DetalleCotizacion();\n      this.altoTablaDetalles = 0;\n      this.tipoPersonaCliente = Utilidades.getTipoCliente();\n      this.labels = {\n        fecha: 'Fecha',\n        cliente: 'Cliente',\n        notas: 'Notas',\n        cantidad: 'Cantidad',\n        descripcion: 'Detalle',\n        precioUnitario: 'Precio unitario',\n        iva: '% IVA',\n        totalIva: 'IVA',\n        precioTotal: 'Total'\n      };\n      this.mensajes = {\n        cotizacionCreada: 'La cotización se ha creado correctamente'\n      };\n      this.columnas = {\n        cantidad: 'Cantidad',\n        descripcion: 'Descripción',\n        precioUnitario: 'Precio unitario',\n        iva: 'IVA',\n        precioTotal: 'Total'\n      };\n      this.botones = {\n        guardar: 'Guardar',\n        eliminar: 'Eliminar'\n      };\n    }\n\n    ngOnInit() {// if(this.route.snapshot.queryParams.id != undefined) {\n      //   this.cotizacion.id =  this.route.snapshot.queryParams.id;\n      //   this.consultarPorId();\n      // }\n    }\n\n    ngAfterViewInit() {\n      setTimeout(() => {\n        this.onResize();\n      });\n    }\n\n    onResize() {\n      let altoDivForm = this.divForm.nativeElement.offsetHeight;\n      let altoDivTabla = window.innerHeight - altoDivForm - 280;\n\n      if (altoDivTabla != this.altoTablaDetalles) {\n        this.altoTablaDetalles = altoDivTabla;\n      }\n    }\n\n    clienteSeleccionado(cliente) {\n      this.cotizacion.cliente = cliente;\n    }\n\n    productoSeleccionado(producto) {\n      this.detalleActual.producto = producto;\n      this.detalleActual.descripcion = this.detalleActual.producto.detalle;\n      this.detalleActual.precioUnitario = this.detalleActual.producto.precio;\n      const inputDetalle = this.frmCotizacion.nativeElement[\"detalle\"];\n\n      if (inputDetalle) {\n        inputDetalle.focus();\n      }\n    }\n\n    agregarDetalle() {\n      if (this.detalleActual.cantidad > 0) {\n        this.detalleActual.porcentajeIva = this.detalleActual.porcentajeIva == null ? 0 : this.detalleActual.porcentajeIva;\n        this.calcularTotalesDetalle();\n        this.cotizacion.detalles.push(this.detalleActual);\n        this.detalleActual = new DetalleCotizacion();\n        this.calcularTotales();\n        this.limpiarDetalle();\n      }\n    }\n\n    calcularTotalesDetalle() {\n      this.detalleActual.precioTotal = this.detalleActual.cantidad * this.detalleActual.precioUnitario;\n      this.detalleActual.valorIva = Utilidades.redondear(this.detalleActual.precioTotal * (this.detalleActual.porcentajeIva / 100));\n      this.detalleActual.precioTotal += Utilidades.redondear(this.detalleActual.valorIva);\n    }\n\n    calcularTotales() {\n      let total = 0;\n      let totalIva = 0;\n      this.cotizacion.detalles.forEach(detalle => {\n        totalIva += detalle.valorIva;\n        total += detalle.precioTotal;\n      });\n      this.cotizacion.totalIva = Utilidades.redondear(totalIva);\n      this.cotizacion.precioTotal = Utilidades.redondear(total);\n    }\n\n    llenarDetalle(detalle, indice) {\n      if (this.detalleActual.producto.referencia == '' && this.cotizacion.id == 0) {\n        this.detalleActual = detalle;\n        this.cotizacion.detalles.splice(indice, 1);\n        this.selectProductos.filtroProducto = this.detalleActual.producto.referencia;\n        this.calcularTotales();\n      }\n    }\n\n    limpiarDetalle() {\n      this.detalleActual = new DetalleCotizacion();\n      this.selectProductos.filtroProducto = '';\n    }\n\n    guardar() {\n      this._cotizacionService.crear(this.cotizacion).subscribe(result => {\n        Utilidades.dialogSuccess(this.mensajes.cotizacionCreada);\n      }, error => {\n        console.log(error);\n      });\n    }\n\n  }\n\n  CotizacionComponent.ɵfac = function CotizacionComponent_Factory(t) {\n    return new (t || CotizacionComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.CotizacionService));\n  };\n\n  CotizacionComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CotizacionComponent,\n    selectors: [[\"app-cotizacion\"]],\n    viewQuery: function CotizacionComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n        i0.ɵɵviewQuery(_c1, 5);\n        i0.ɵɵviewQuery(_c2, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.divForm = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.frmCotizacion = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.selectProductos = _t.first);\n      }\n    },\n    hostBindings: function CotizacionComponent_HostBindings(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵlistener(\"resize\", function CotizacionComponent_resize_HostBindingHandler($event) {\n          return ctx.onResize($event);\n        }, false, i0.ɵɵresolveWindow);\n      }\n    },\n    features: [i0.ɵɵProvidersFeature([CotizacionService])],\n    decls: 80,\n    vars: 28,\n    consts: [[1, \"form-filtros\"], [\"divForm\", \"\"], [\"autocomplete\", \"off\", 3, \"keydown.enter\"], [\"frmCotizacion\", \"\"], [1, \"field\", \"is-horizontal\"], [1, \"field-label\", \"is-normal\"], [1, \"level-left\"], [1, \"field-body\"], [1, \"control\"], [\"type\", \"date\", \"name\", \"fecha\", 1, \"input\", 3, \"ngModel\", \"ngModelChange\"], [3, \"labelPersona\", \"tipoPersona\", \"personaSeleccionada\"], [\"txtCliente\", \"\"], [\"name\", \"notas\", 1, \"textarea\", 3, \"ngModel\", \"ngModelChange\"], [1, \"box\"], [1, \"field\", \"is-grouped\"], [1, \"control\", \"txt-pequenno\"], [\"type\", \"number\", \"name\", \"cantidad\", 1, \"input\", 3, \"placeholder\", \"ngModel\", \"ngModelChange\"], [3, \"productoSeleccionado\"], [\"selectProducto\", \"\"], [1, \"control\", \"is-expanded\"], [\"type\", \"text\", \"name\", \"descripcion\", 1, \"input\", 3, \"placeholder\", \"ngModel\", \"ngModelChange\"], [1, \"control\", \"txt-valor\"], [\"type\", \"number\", \"name\", \"iva\", 1, \"input\", 3, \"placeholder\", \"ngModel\", \"ngModelChange\"], [\"type\", \"number\", \"name\", \"precioUnitario\", 1, \"input\", 3, \"placeholder\", \"ngModel\", \"ngModelChange\"], [1, \"button\", \"is-primary\", 3, \"click\", \"keydown.enter\"], [1, \"icon\", \"is-small\"], [1, \"fas\", \"fa-plus\"], [1, \"div-tabla\"], [\"divTablaDetalles\", \"\"], [1, \"table\", \"is-fullwidth\", \"is-bordered\"], [\"width\", \"10%\"], [\"width\", \"12%\"], [3, \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"field\", \"is-grouped\", \"is-grouped-right\"], [\"type\", \"text\", \"name\", \"totalIva\", \"disabled\", \"\", 1, \"input\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"text\", \"name\", \"precioTotal\", \"disabled\", \"\", 1, \"input\", 3, \"ngModel\", \"ngModelChange\"], [1, \"button\", \"is-primary\", 3, \"click\"], [1, \"button\", \"is-danger\"], [1, \"button\", \"has-text-primary\"], [1, \"fas\", \"fa-eraser\"], [3, \"click\"]],\n    template: function CotizacionComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0, 1)(2, \"form\", 2, 3);\n        i0.ɵɵlistener(\"keydown.enter\", function CotizacionComponent_Template_form_keydown_enter_2_listener($event) {\n          return $event.preventDefault();\n        });\n        i0.ɵɵelementStart(4, \"div\", 4)(5, \"div\", 5)(6, \"label\", 6);\n        i0.ɵɵtext(7);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(8, \"div\", 7)(9, \"div\", 8)(10, \"input\", 9);\n        i0.ɵɵlistener(\"ngModelChange\", function CotizacionComponent_Template_input_ngModelChange_10_listener($event) {\n          return ctx.cotizacion.fecha = $event;\n        });\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(11, \"app-txt-persona\", 10, 11);\n        i0.ɵɵlistener(\"personaSeleccionada\", function CotizacionComponent_Template_app_txt_persona_personaSeleccionada_11_listener($event) {\n          return ctx.clienteSeleccionado($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"div\", 4)(14, \"div\", 5)(15, \"label\", 6);\n        i0.ɵɵtext(16);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(17, \"div\", 7)(18, \"textarea\", 12);\n        i0.ɵɵlistener(\"ngModelChange\", function CotizacionComponent_Template_textarea_ngModelChange_18_listener($event) {\n          return ctx.cotizacion.notas = $event;\n        });\n        i0.ɵɵtext(19, \"            \");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(20, \"div\", 13)(21, \"div\", 14)(22, \"div\", 15)(23, \"input\", 16);\n        i0.ɵɵlistener(\"ngModelChange\", function CotizacionComponent_Template_input_ngModelChange_23_listener($event) {\n          return ctx.detalleActual.cantidad = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(24, \"div\", 8)(25, \"app-select-productos\", 17, 18);\n        i0.ɵɵlistener(\"productoSeleccionado\", function CotizacionComponent_Template_app_select_productos_productoSeleccionado_25_listener($event) {\n          return ctx.productoSeleccionado($event);\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(27, \"div\", 19)(28, \"input\", 20);\n        i0.ɵɵlistener(\"ngModelChange\", function CotizacionComponent_Template_input_ngModelChange_28_listener($event) {\n          return ctx.detalleActual.descripcion = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(29, \"div\", 21)(30, \"input\", 22);\n        i0.ɵɵlistener(\"ngModelChange\", function CotizacionComponent_Template_input_ngModelChange_30_listener($event) {\n          return ctx.detalleActual.porcentajeIva = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(31, \"div\", 21)(32, \"input\", 23);\n        i0.ɵɵlistener(\"ngModelChange\", function CotizacionComponent_Template_input_ngModelChange_32_listener($event) {\n          return ctx.detalleActual.precioUnitario = $event;\n        });\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(33, \"div\", 8)(34, \"button\", 24);\n        i0.ɵɵlistener(\"click\", function CotizacionComponent_Template_button_click_34_listener() {\n          return ctx.agregarDetalle();\n        })(\"keydown.enter\", function CotizacionComponent_Template_button_keydown_enter_34_listener() {\n          return ctx.agregarDetalle();\n        });\n        i0.ɵɵelementStart(35, \"span\", 25);\n        i0.ɵɵelement(36, \"i\", 26);\n        i0.ɵɵelementEnd()()()()()()();\n        i0.ɵɵelementStart(37, \"div\", 27, 28)(39, \"table\", 29)(40, \"thead\")(41, \"tr\")(42, \"th\", 30);\n        i0.ɵɵtext(43);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(44, \"th\");\n        i0.ɵɵtext(45);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(46, \"th\", 31);\n        i0.ɵɵtext(47);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(48, \"th\", 31);\n        i0.ɵɵtext(49);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(50, \"th\", 31);\n        i0.ɵɵtext(51);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(52, \"tbody\");\n        i0.ɵɵtemplate(53, CotizacionComponent_tr_53_Template, 11, 5, \"tr\", 32);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelement(54, \"br\");\n        i0.ɵɵelementStart(55, \"div\", 33)(56, \"div\", 8)(57, \"div\", 4)(58, \"div\", 5)(59, \"label\", 6);\n        i0.ɵɵtext(60);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(61, \"div\", 7)(62, \"input\", 34);\n        i0.ɵɵlistener(\"ngModelChange\", function CotizacionComponent_Template_input_ngModelChange_62_listener($event) {\n          return ctx.cotizacion.totalIva = $event;\n        });\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(63, \"div\", 4)(64, \"div\", 5)(65, \"label\", 6);\n        i0.ɵɵtext(66);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(67, \"div\", 7)(68, \"input\", 35);\n        i0.ɵɵlistener(\"ngModelChange\", function CotizacionComponent_Template_input_ngModelChange_68_listener($event) {\n          return ctx.cotizacion.precioTotal = $event;\n        });\n        i0.ɵɵelementEnd()()()()();\n        i0.ɵɵelementStart(69, \"div\", 33)(70, \"div\", 8)(71, \"button\", 36);\n        i0.ɵɵlistener(\"click\", function CotizacionComponent_Template_button_click_71_listener() {\n          return ctx.guardar();\n        });\n        i0.ɵɵtext(72);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(73, \"div\", 8)(74, \"button\", 37);\n        i0.ɵɵtext(75);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(76, \"div\", 8)(77, \"button\", 38)(78, \"span\", 25);\n        i0.ɵɵelement(79, \"i\", 39);\n        i0.ɵɵelementEnd()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(7);\n        i0.ɵɵtextInterpolate(ctx.labels.fecha);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngModel\", ctx.cotizacion.fecha);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"labelPersona\", ctx.labels.cliente)(\"tipoPersona\", ctx.tipoPersonaCliente);\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate(ctx.labels.notas);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.cotizacion.notas);\n        i0.ɵɵadvance(5);\n        i0.ɵɵpropertyInterpolate(\"placeholder\", ctx.labels.cantidad);\n        i0.ɵɵproperty(\"ngModel\", ctx.detalleActual.cantidad);\n        i0.ɵɵadvance(5);\n        i0.ɵɵpropertyInterpolate(\"placeholder\", ctx.labels.descripcion);\n        i0.ɵɵproperty(\"ngModel\", ctx.detalleActual.descripcion);\n        i0.ɵɵadvance(2);\n        i0.ɵɵpropertyInterpolate(\"placeholder\", ctx.labels.iva);\n        i0.ɵɵproperty(\"ngModel\", ctx.detalleActual.porcentajeIva);\n        i0.ɵɵadvance(2);\n        i0.ɵɵpropertyInterpolate(\"placeholder\", ctx.labels.precioUnitario);\n        i0.ɵɵproperty(\"ngModel\", ctx.detalleActual.precioUnitario);\n        i0.ɵɵadvance(5);\n        i0.ɵɵstyleProp(\"height\", ctx.altoTablaDetalles, \"px\");\n        i0.ɵɵadvance(6);\n        i0.ɵɵtextInterpolate(ctx.columnas.cantidad);\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate(ctx.columnas.descripcion);\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate(ctx.columnas.precioUnitario);\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate(ctx.columnas.iva);\n        i0.ɵɵadvance(2);\n        i0.ɵɵtextInterpolate(ctx.columnas.precioTotal);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.cotizacion.detalles);\n        i0.ɵɵadvance(7);\n        i0.ɵɵtextInterpolate(ctx.labels.totalIva);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.cotizacion.totalIva);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate(ctx.labels.precioTotal);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.cotizacion.precioTotal);\n        i0.ɵɵadvance(4);\n        i0.ɵɵtextInterpolate1(\" \", ctx.botones.guardar, \" \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate1(\" \", ctx.botones.eliminar, \" \");\n      }\n    },\n    directives: [i3.ɵNgNoValidate, i3.NgControlStatusGroup, i3.NgForm, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgModel, i4.TxtPersonaComponent, i3.NumberValueAccessor, i5.SelectProductosComponent, i6.NgForOf],\n    styles: [\"\"]\n  });\n  return CotizacionComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}